var e,n=Object.prototype.hasOwnProperty,t=function(e){return null==e},r=Array.isArray,o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;function a(e,t){if(r(e))return e;if(t&&(a=t,i=e,n.call(a,i)))return[e];var a,i,u=[];return e.replace(o,(function(e,n,t,r){return u.push(t?r.replace(/\\(\\)?/g,"$1"):n||e),r})),u}function i(e){return e.__wxWebviewId__?e.__wxWebviewId__:e.privateProperties?e.privateProperties.slaveId:e.$page?e.$page.id:void 0}function u(e){return e.route||e.uri}function c(e){return e.options||e.$page&&e.$page.options||{}}function s(e){return{id:i(e),path:u(e),query:c(e)}}function f(e){var n=function(e){return getCurrentPages().find((function(n){return i(n)===e}))}(e);return n&&n.$vm}function d(e,n){var t;return e&&(!function(e,n){return e.$scope&&((t=e.$scope).__wxExparserNodeId__||t.nodeId||t.id)===n;var t}(e,n)?e.$children.find((function(e){return t=d(e,n)})):t=e),t}function g(e,n){var t=f(e);return t&&d(t,n)}function l(e,n){var r;return e&&(r=n?function(e,n){var r,o=a(n,e);for(r=o.shift();!t(r);){if(null==(e=e[r]))return;r=o.shift()}return e}(e.$data,n):Object.assign({},e.$data)),Promise.resolve({data:r})}function p(e,n){return e&&Object.keys(n).forEach((function(t){e[t]=n[t]})),Promise.resolve()}function m(n,t,r){return new Promise((function(o,a){if(!n)return a(e.VM_NOT_EXISTS);if(!n[t])return a(e.VM_NOT_EXISTS);var i,u=n[t].apply(n,r);!(i=u)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then?o({result:u}):u.then((function(e){o({result:e})}))}))}!function(e){e.VM_NOT_EXISTS="VM_NOT_EXISTS",e.METHOD_NOT_EXISTS="METHOD_NOT_EXISTS"}(e||(e={}));var h=["stopRecord","getRecorderManager","pauseVoice","stopVoice","pauseBackgroundAudio","stopBackgroundAudio","getBackgroundAudioManager","createAudioContext","createInnerAudioContext","createVideoContext","createCameraContext","createMapContext","canIUse","startAccelerometer","stopAccelerometer","startCompass","stopCompass","hideToast","hideLoading","showNavigationBarLoading","hideNavigationBarLoading","navigateBack","createAnimation","pageScrollTo","createSelectorQuery","createCanvasContext","createContext","drawCanvas","hideKeyboard","stopPullDownRefresh","arrayBufferToBase64","base64ToArrayBuffer"],v={},T=/Sync$/,_=/^on|^off/;function E(e){return T.test(e)||-1!==h.indexOf(e)}var O={getPageStack:function(){return Promise.resolve({pageStack:getCurrentPages().map((function(e){return s(e)}))})},getCurrentPage:function(){var e=getCurrentPages(),n=e.length;return new Promise((function(t,r){n?t(s(e[n-1])):r(Error("getCurrentPages().length=0"))}))},callUniMethod:function(e){var n=e.method,t=e.args;return new Promise((function(e,r){if(!uni[n])return r(Error("uni."+n+" not exists"));if(E(n))return e({result:uni[n].apply(uni,t)});var o=[Object.assign({},t[0]||{},{success:function(t){setTimeout((function(){e({result:t})}),"pageScrollTo"===n?350:0)},fail:function(e){r(Error(e.errMsg.replace(n+":fail ","")))}})];uni[n].apply(uni,o)}))},mockUniMethod:function(e){var n=e.method;if(!uni[n])throw Error("uni."+n+" not exists");if(!function(e){return!_.test(e)}(n))throw Error("You can't mock uni."+n);var r,o=e.result,a=e.functionDeclaration;return t(o)&&t(a)?(v[n]&&(uni[n]=v[n],delete v[n]),Promise.resolve()):(r=t(a)?E(n)?function(){return o}:function(e){setTimeout((function(){o.errMsg&&-1!==o.errMsg.indexOf(":fail")?e.fail&&e.fail(o):e.success&&e.success(o),e.complete&&e.complete(o)}),4)}:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return new Function("return "+a)().apply(r,n.concat(e.args))},r.origin=v[n]||uni[n],v[n]||(v[n]=uni[n]),uni[n]=r,Promise.resolve())}},S={getData:function(e){return l(f(e.pageId),e.path)},setData:function(e){return p(f(e.pageId),e.data)},callMethod:function(n){var t,r=((t={})[e.VM_NOT_EXISTS]="Page["+n.pageId+"] not exists",t[e.METHOD_NOT_EXISTS]="page."+n.method+" not exists",t);return new Promise((function(e,t){m(f(n.pageId),n.method,n.args).then((function(n){return e(n)})).catch((function(e){t(Error(r[e]))}))}))}};function I(e){return e.nodeId||e.elementId}var y={getData:function(e){return l(g(e.pageId,I(e)),e.path)},setData:function(e){return p(g(e.pageId,I(e)),e.data)},callMethod:function(n){var t,r=I(n),o=((t={})[e.VM_NOT_EXISTS]="Component["+n.pageId+":"+r+"] not exists",t[e.METHOD_NOT_EXISTS]="component."+n.method+" not exists",t);return new Promise((function(e,t){m(g(n.pageId,r),n.method,n.args).then((function(n){return e(n)})).catch((function(e){t(Error(o[e]))}))}))}},M={};Object.keys(O).forEach((function(e){M["App."+e]=O[e]})),Object.keys(S).forEach((function(e){M["Page."+e]=S[e]})),Object.keys(y).forEach((function(e){M["Element."+e]=y[e]}));var P,C=process.env.UNI_AUTOMATOR_WS_ENDPOINT;function w(e){P.send({data:JSON.stringify(e)})}function x(e){var n=JSON.parse(e.data),t=n.id,r=n.method,o=n.params,a={id:t},i=M[r];if(!i&&!i)return a.error={message:r+" unimplemented"},w(a);try{i(o).then((function(e){e&&(a.result=e)})).catch((function(e){a.error={message:e.message}})).finally((function(){w(a)}))}catch(e){a.error={message:e.message},w(a)}}swan.$$initRuntimeAutomator=function(e){void 0===e&&(e={}),(P=uni.connectSocket({url:C,complete:function(){}})).onMessage(x),P.onOpen((function(n){e.success&&e.success(),console.log("已开启自动化测试...")})),P.onError((function(e){console.log("automator.onError",e)})),P.onClose((function(){e.fail&&e.fail({errMsg:"$$initRuntimeAutomator:fail"}),console.log("automator.onClose")}))},setTimeout((function(){swan.$$initRuntimeAutomator()}),500);
